\documentclass[final,handout]{beamer}

% OHDSI Symposium posters should be a maximum size of 48 " x 32" (Horizontal)

% 42" x 36"
\usepackage[size=custom,width=106.68,height=81.28,scale=1.5,debug]{beamerposter}

\usepackage[utf8]{inputenc}

%% BIB
%\usepackage[style=authoryear,backend=biber,doi=false,isbn=false,url=false,eprint=false,firstinits=true]{biblatex}
%\addbibresource{../nems.bib}
%\addbibresource{../yeast.bib}
%\renewcommand*{\bibfont}{\scriptsize}

%% FOR FIGURES
%\usepackage{epstopdf}

%% GRAPHICS
\usepackage{graphicx}
\graphicspath{{../figures/},{../images/}}
\DeclareGraphicsExtensions{.pdf,.png}

%% FOR TABLES
%\usepackage{colortbl}
%\usepackage{multirow}
%\usepackage{rotating}

%% SYMBOLS
%\DeclareMathOperator*{\argmax}{argmax}

%% COLORS
% It's good practice to only use a few colors.
% Defining them here makes it easy to change the color scheme by only changing the colors in one place.
\definecolor{StrongBlue}{HTML}{20558a} % Matches NIH logo  % NOT USED
\definecolor{SoftBlue}{HTML}{3F8FD2} %% Need to correct    % NOT USED
\definecolor{StrongGreen}{HTML}{00733E}                    % NOT USED
\definecolor{SoftGreen}{HTML}{36D88E}                      % NOT USED
\definecolor{StrongRed}{HTML}{7E0A26}                      % NOT USED
\definecolor{SoftRed}{HTML}{D0113F} % Matches UW logo      % NOT USED

\definecolor{MyC}{HTML}{009999}                            % NOT USED
\definecolor{MyM}{HTML}{990099}                            % NOT USED
\definecolor{MyY}{HTML}{999900}                            % NOT USED
\definecolor{MyR}{HTML}{990000}                            % NOT USED
\definecolor{MyG}{HTML}{009900}                            % NOT USED
\definecolor{MyB}{HTML}{000099}                            % NOT USED
\definecolor{ActionRed}{HTML}{990000}                      %

\setbeamercolor{structure}{fg=ActionRed}
\setbeamercolor{alerted text}{use=structure,fg=structure.fg}
\setbeamercolor{block title}{use=structure,fg=structure.bg,bg=structure.fg}
\setbeamercolor{block title example}{use=structure,fg=structure.fg,bg=structure.bg}

%% CODE
\usepackage{listings}
\lstset{
	frame=tb,
	language=R,
	basicstyle={\ttfamily},
	commentstyle={\it \color{StrongBlue}},
	tabsize=3,
	breaklines=true,
	postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space}
}

%% DRAWING
\usepackage{tikz}
\usetikzlibrary{matrix}
%\usetikzlibrary{fit,calc,arrows,arrows.meta,decorations.pathreplacing,decorations.text,decorations.pathmorphing,backgrounds,fit,positioning,shapes,chains,topaths,matrix,backgrounds}

%\def\firstcircle{(90:0.3cm) circle (0.6cm)}
%\def\secondcircle{(210:0.3cm) circle (0.6cm)}
%\def\thirdcircle{(330:0.3cm) circle (0.6cm)}

%\tikzset{%
%	link/.style={->,>=angle 45,semithick},
%	var/.style={circle,draw,minimum size=1.5em,align=center, inner sep=0pt, anchor=center},
%	text block/.style={rectangle, rounded corners, draw=#1, fill=white, thick, text width=5em, align=center},
%	thick arrow/.style={
%		-{Triangle[angle=120:1pt 1]},
%		%     -Triangle,
%		line width=2em, 
%		draw=SoftBlue
%	},
%	arrow label/.style={
%		font=\sf,
%		align=center
%	},
%	set mark/.style={
%		insert path={
%			node [midway, arrow label, node contents=#1]
%		}
%	},
%	set vertical mark/.style={
%		insert path={
%			node [midway, arrow label, node contents=#1, rotate=-90]
%		}
%	}
%}

%% POSTER TEMPLATE DEFINITION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\setbeamertemplate{navigation symbols}{}  % no navigation on a poster
%%%%%%%%%%%%%%%%%%%%%%%

\title{Baseline Regularization: an R package for identifying adverse and beneficial drug effects from longitudinal observational data}
\subtitle{yuriy.sverchkov@wisc.edu} % Yes, it's a bit hacky but it's simple.
\author{Yuriy Sverchkov\textsuperscript{1} \and Zhaobin Kuang\textsuperscript{2} \and Mark Craven\textsuperscript{1,2} \and David Page \textsuperscript{1,2}}
\institute{\textsuperscript{1}Department of Biostatistics and Medical Informatics, \textsuperscript{2}Department of Computer Sciences, University~of~Wisconsin--Madison}

\begin{document}
	\begin{frame}[plain] %Everything is going to be inside this one frame
	% Everything is going to also be inside a tikz picture
	\begin{tikzpicture}[
	overlay,
	remember picture,
	shift={(current page.north west)},
	yscale=-1,%]
	every node/.style={draw, very thin}]
	\small%\scriptsize
	
	
	\draw [line width=2mm,blue!40,step=5cm] (0,0) grid (106,81);
	\draw [blue!20,step=1cm] (0,0) grid (106,81);
	%\draw (0,1) -- (91.44,1);
	
	%%TITLE
	\matrix at (0.5cm,0.5cm) [anchor=north west, matrix of nodes, nodes={anchor=west, text width=90cm}]{
		\usebeamercolor[fg]{title in headline}{\textbf{\LARGE{\inserttitle}}} \\
		\usebeamercolor[fg]{author in headline}{\large{\insertauthor}} \\
		\usebeamercolor[fg]{author in head/foot}{\small{\texttt{\insertsubtitle}}} \\
		\usebeamercolor[fg]{institute in headline}{\large{\insertinstitute}} \\
	};
	%\node[anchor=north west, inner sep=0] at (66cm, 1cm) {\includegraphics[width=10cm]{CPCP-logo-2}};
	\node[anchor=north west, inner sep=0] at (90cm, 1cm) {\includegraphics[trim={2.5cm 3cm 2.5cm 1cm},width=14cm]{UWlogo_ctr_4c}};
	
	%% Template:
	%\begin{scope}[shift={(40cm,15cm)}]
	%\node[color=white, fill=red, anchor=south west] {\large Section title};
	%\node[anchor=north west, text width=30cm, align=left] {
	%	Section text
	%};
	%\end{scope}
	
	%% ABSTRACT
	%\begin{scope}[shift={(1cm,15cm)}]
	%	\node[color=white, fill=red, anchor=south west] {\large Abstract};
	%	\node[anchor=north west, text width=30cm, align=left] {
	%		While drugs are designed and indicated to treat specific medical conditions, it is well documented that exposure to a drug often affects a patient’s risk for a medical condition other than the drug’s intended treatment target. Such effects of drug exposures on risk are of interest both in the context of pharmacovigilance and for drug repositioning tasks. Baseline Regularization is an algorithm for identifying such effects on risk in longitudinal observational data (LOD) such as electronic medical records (EMR). We present an implementation of Baseline Regularization, in the form of an R package, that is designed to work with LOD that follows the Observational Medical Outcomes Partnership’s (OMOP) Common Data Model (CDM). Our aim is to facilitate the application of Baseline Regularization by researchers across the Observational Health Data Sciences and Informatics (OHDSI) network in pharmacovigilance, drug repositioning, and other research.
	%	};
	%\end{scope}
	
	%% Introduction
	\begin{scope}[shift={(1cm,15cm)}]
	\node[color=white, fill=ActionRed, anchor=south west] {\large Introduction};
	\node[anchor=north west, text width=30cm, align=left] {
		\emph{Baseline Regularization} is an algorithm for identifying adverse and beneficial effects of drug exposure on a patient's risk of condition occurrence from longtitudonal observational data.
		
		Drug effects on condition risk are of interest for:
		\begin{itemize}
		\item \emph{Pharmacovigiallance:} the surveillance and prevention of adverse drug events.
		\item \emph{Drug repurposing/repositioning:} the use of drugs to treat conditions other than their originally intended target.
		\end{itemize} 
		
		A major challenge of inferring drug effects on condition risk from longtitudonal oservational data is the heterogeneous nature of the data, particularly:
		\begin{itemize}
		\item Heterogeneity between patients due to
			\begin{itemize}
			\item genetics,
			\item environmental factors,
			\item unique events in a patient's history.
			\end{itemize}
		\item Heterogeneity across time for a single patient due to
			\begin{itemize}
			\item increase of condition risk as a patient ages,
			\item health-related events during the observation period,
			\item and other changes in a patient's health over time.
			\end{itemize}
		\end{itemize}
		
		Baseline Regularization addressed this heterogeneity by explicitly modeling a time-varying patient-sepcific baseline baseline risk for each patient.
	};
	\end{scope}

	% Methods
	\begin{scope}[shift={(37cm,15cm)}]
		\node[color=white, fill=ActionRed, anchor=south west] {\large Methods};
		\node[anchor=north west, text width=30cm, align=left] {
			Baseline Regularization fits a Poisson regression model where the response is the occurrence of a condition of interest.
			
			We view each patient’s EMR as one or more observation periods during which the patient experiences intervals of exposure to drugs and occurrences of the condition on specific days.
			
			%In the OMOP CDM, observation periods may be explicitly defined, if it is not, we may infer the observation period to last from the first to the last occurrences of conditions, patient visits, or drug exposures. Intervals of exposure to drugs directly correspond to the derived CDM Drug Era table; when this table isn’t available we may infer these intervals from the Drug Exposure clinical data table. The days of condition occurrence are taken to be either the start day of each Condition Era (derived table) or the start day of each Condition Occurrence (clinical table).
			
			(interval fig here)
			
			The model likelihood is
			
			$\displaystyle \log \mathcal{L} = $
			
			where			
			\begin{description}
			\item[$i$] patient (or more generally, observation period)
			\item[$j$] day
			\item[$m$] drug
			\item[$x_{ijm}$] inicator of patient $i$'s exposure to drug $m$ on day $j$
			\item[$y_{ij}$] indicator of condition occurrence for patient $i$ on day $j$
			\item[$\beta_m$] contribution to condition risk from drug
			\item[$\tau_{ij}$] baseline risk for patient $i$ on day $j$
			\end{description}
			
			This likelihood function is overparametrized, and to address this issue, Baseline Regularization solves the regularized optimization problem
			
			$\displaystyle \arg \min \ldots$
			
			Kwong et al. (1) derive the algorithm for solving this optimization efficiently, which we implement in our package.
			%The result of fitting baseline regularization to data yields the baseline coefficients $\tau$, drug coefficients $\beta$. The latter represent the effect of drug exposures on the risk of condition occurrence. Large positive coefficients may point to adverse reactions, while high magnitude negative coefficients may point to a beneficial effect (reduction of condition risk due to the drug).
			
			(Risk contribution figure)
		};
	\end{scope}
	
	%% R Package
	\begin{scope}[shift={(73cm,15cm)}] % was 1, 50
	\node[color=white, fill=ActionRed, anchor=south west] {\large R Package};
	\node[anchor=north west, text width=30cm, align=left] {
		The package is available on GithHub at \url{https://github.com/sverchkov/BaselineRegularization}
		
		\textbf{Installation}
		
		\lstinputlisting{installation.R}
		
		\textbf{Usage}
		
		\lstinputlisting{usage.R}
		
		An in-depth tutorial can be found in the R vignette
		
		\lstinputlisting{vignette.R} };
	\end{scope}

	%% Results and Discussion:
	\begin{scope}[shift={(1cm,50cm)}]
		\node[color=white, fill=red, anchor=south west] {\large Results and Discussion};
		\node[anchor=north west, text width=30cm, align=left] {
			We implemented Baseline Regularization and made it available as an R package on github http://github.com/sverchkov/BaselineRegularization. The package is designed to work either with the Standardized Clinical Data Tables or with the Standardized Derived Elements of the OMOP CDM.
			
			While it is up to the user to choose appropriate values for the regularization parameters $\lambda_1$, $\lambda_2$, and $\lambda_3$, we provide defaults that have been shown to perform well in previous studies (1). Since we utilize the dplyr package (2) in our conversion of the data from the CDM to the matrix and vector notation used by the optimization problem, our package can work with a variety of database backends as well as in-memory tables (R dataframes), and can handle working with combinations of data sources. For best results with large datasets, however, we recommend that all tables come from the same full-featured relational database. We also provide additional data processing utilities, which enable the user to easily work with different levels of drug and condition abstraction: the data in clinical tables needs to be at the most specific level, but a pharmacovigilance/repurposing analysis may be better performed at a higher level of abstraction, where, instead of using a specific drug as a feature, a researcher might want to use a general category such as “Beta Blockers” as a drug feature.
			
			We plan to continue maintaining and extending the package in response to community needs in order to facilitate adoption and application of Baseline Regularization in the OHDSI network and the broader research community.
			
		};
	\end{scope}


	%% Refs:
	\begin{scope}[shift={(70cm,70cm)}]
	\node[color=white, fill=red, anchor=south west] {\large References};
	\node[anchor=north west, text width=30cm, align=left] {
		(todo)
	};
	\end{scope}
	
	\end{tikzpicture}
\end{frame}
\end{document}