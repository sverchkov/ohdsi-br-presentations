\documentclass[final,handout]{beamer}

% OHDSI Symposium posters should be a maximum size of 48 " x 32" (Horizontal)

% 42" x 36"
\usepackage[size=custom,width=106.68,height=81.28,scale=1.5,debug]{beamerposter}

\usepackage[utf8]{inputenc}

%% BIB
%\usepackage[style=authoryear,backend=biber,doi=false,isbn=false,url=false,eprint=false,firstinits=true]{biblatex}
%\addbibresource{../nems.bib}
%\addbibresource{../yeast.bib}
%\renewcommand*{\bibfont}{\scriptsize}

%% FOR FIGURES
%\usepackage{epstopdf}

%% GRAPHICS
\usepackage{graphicx}
\graphicspath{{../figures/},{../images/}}
\DeclareGraphicsExtensions{.pdf,.png}

%% FOR TABLES
%\usepackage{colortbl}
%\usepackage{multirow}
%\usepackage{rotating}

%% SYMBOLS
%\DeclareMathOperator*{\argmax}{argmax}

%% COLORS
% It's good practice to only use a few colors.
% Defining them here makes it easy to change the color scheme by only changing the colors in one place.
\definecolor{StrongBlue}{HTML}{20558a} % Matches NIH logo  % NOT USED
\definecolor{SoftBlue}{HTML}{3F8FD2} %% Need to correct    % NOT USED
\definecolor{StrongGreen}{HTML}{00733E}                    % NOT USED
\definecolor{SoftGreen}{HTML}{36D88E}                      % NOT USED
\definecolor{StrongRed}{HTML}{7E0A26}                      % NOT USED
\definecolor{SoftRed}{HTML}{D0113F} % Matches UW logo      % NOT USED

\definecolor{MyC}{HTML}{009999}                            % NOT USED
\definecolor{MyM}{HTML}{990099}                            % NOT USED
\definecolor{MyY}{HTML}{999900}                            % NOT USED
\definecolor{MyR}{HTML}{990000}                            % NOT USED
\definecolor{MyG}{HTML}{009900}                            % NOT USED
\definecolor{MyB}{HTML}{000099}                            % NOT USED
\definecolor{ActionRed}{HTML}{990000}                      %

\setbeamercolor{structure}{fg=ActionRed}
\setbeamercolor{alerted text}{use=structure,fg=structure.fg}
\setbeamercolor{block title}{use=structure,fg=structure.bg,bg=structure.fg}
\setbeamercolor{block title example}{use=structure,fg=structure.fg,bg=structure.bg}

%% CODE
\usepackage{listings}
\lstset{
	frame=tb,
	language=R,
	basicstyle={\ttfamily},
	tabsize=3
}

%% DRAWING
\usepackage{tikz}
\usetikzlibrary{matrix}
%\usetikzlibrary{fit,calc,arrows,arrows.meta,decorations.pathreplacing,decorations.text,decorations.pathmorphing,backgrounds,fit,positioning,shapes,chains,topaths,matrix,backgrounds}

%\def\firstcircle{(90:0.3cm) circle (0.6cm)}
%\def\secondcircle{(210:0.3cm) circle (0.6cm)}
%\def\thirdcircle{(330:0.3cm) circle (0.6cm)}

%\tikzset{%
%	link/.style={->,>=angle 45,semithick},
%	var/.style={circle,draw,minimum size=1.5em,align=center, inner sep=0pt, anchor=center},
%	text block/.style={rectangle, rounded corners, draw=#1, fill=white, thick, text width=5em, align=center},
%	thick arrow/.style={
%		-{Triangle[angle=120:1pt 1]},
%		%     -Triangle,
%		line width=2em, 
%		draw=SoftBlue
%	},
%	arrow label/.style={
%		font=\sf,
%		align=center
%	},
%	set mark/.style={
%		insert path={
%			node [midway, arrow label, node contents=#1]
%		}
%	},
%	set vertical mark/.style={
%		insert path={
%			node [midway, arrow label, node contents=#1, rotate=-90]
%		}
%	}
%}

%% POSTER TEMPLATE DEFINITION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\setbeamertemplate{navigation symbols}{}  % no navigation on a poster
%%%%%%%%%%%%%%%%%%%%%%%

\title{Baseline Regularization: an R package for identifying adverse and beneficial drug effects from longitudinal observational data}
\subtitle{yuriy.sverchkov@wisc.edu} % Yes, it's a bit hacky but it's simple.
\author{Yuriy Sverchkov\textsuperscript{1} \and Zhaobin Kuang\textsuperscript{2} \and Mark Craven\textsuperscript{1,2} \and David Page \textsuperscript{1,2}}
\institute{\textsuperscript{1}Department of Biostatistics and Medical Informatics, \textsuperscript{2}Department of Computer Sciences, University~of~Wisconsin--Madison}

\begin{document}
	\begin{frame}[plain] %Everything is going to be inside this one frame
	% Everything is going to also be inside a tikz picture
	\begin{tikzpicture}[
	overlay,
	remember picture,
	shift={(current page.north west)},
	yscale=-1,%]
	every node/.style={draw, very thin}]
	\small%\scriptsize
	
	
	\draw [very thick,black!40,step=10cm] (0,0) grid (106,81);
	\draw [black!20,step=5cm] (0,0) grid (106,81);
	%\draw (0,1) -- (91.44,1);
	
	%%TITLE
	\matrix at (0.5cm,0.5cm) [anchor=north west, matrix of nodes, nodes={anchor=west, text width=90cm}]{
		\usebeamercolor[fg]{title in headline}{\textbf{\LARGE{\inserttitle}}} \\
		\usebeamercolor[fg]{author in headline}{\large{\insertauthor}} \\
		\usebeamercolor[fg]{author in head/foot}{\small{\texttt{\insertsubtitle}}} \\
		\usebeamercolor[fg]{institute in headline}{\large{\insertinstitute}} \\
	};
	%\node[anchor=north west, inner sep=0] at (66cm, 1cm) {\includegraphics[width=10cm]{CPCP-logo-2}};
	\node[anchor=north west, inner sep=0] at (90cm, 1cm) {\includegraphics[trim={2.5cm 3cm 2.5cm 1cm},width=14cm]{UWlogo_ctr_4c}};
	
	%% Template:
	%\begin{scope}[shift={(40cm,15cm)}]
	%\node[color=white, fill=red, anchor=south west] {\large Section title};
	%\node[anchor=north west, text width=30cm, align=left] {
	%	Section text
	%};
	%\end{scope}
	
	%% ABSTRACT
	\begin{scope}[shift={(1cm,15cm)}]
		\node[color=white, fill=red, anchor=south west] {\large Abstract};
		\node[anchor=north west, text width=30cm, align=left] {
			While drugs are designed and indicated to treat specific medical conditions, it is well documented that exposure to a drug often affects a patient’s risk for a medical condition other than the drug’s intended treatment target. Such effects of drug exposures on risk are of interest both in the context of pharmacovigilance and for drug repositioning tasks. Baseline Regularization is an algorithm for identifying such effects on risk in longitudinal observational data (LOD) such as electronic medical records (EMR). We present an implementation of Baseline Regularization, in the form of an R package, that is designed to work with LOD that follows the Observational Medical Outcomes Partnership’s (OMOP) Common Data Model (CDM). Our aim is to facilitate the application of Baseline Regularization by researchers across the Observational Health Data Sciences and Informatics (OHDSI) network in pharmacovigilance, drug repositioning, and other research.
		};
	\end{scope}
	
	%% Introduction
	\begin{scope}[shift={(1cm,40cm)}]
	\node[color=white, fill=red, anchor=south west] {\large Introduction};
	\node[anchor=north west, text width=30cm, align=left] {
		While drugs are designed and indicated to treat specific medical conditions, it is well documented that exposure to a drug often affects a patient’s risk for a medical condition other than the drug’s intended treatment target. When the drug elevates the risk of an adverse condition it may lead to an adverse drug event (ADE). Pharmacovigilance, the surveillance and prevention of ADEs caused by pharmacological products after they are introduced to the market, is of great interest to governments, industries, and other stakeholders. Identifying the effect of drug exposure on condition risk is important part of pharmacovigilance. It is also possible that a drug reduces the risk of a condition other than the drug’s intended target. In such a case, the drug may potentially be repurposed/repositioned for treatment of this other condition. Drug repositioning is of great interest to the health industry since it opens up new treatment options while bypassing the slow, expensive, and risky process of developing and testing a new drug. Hence, identifying both adverse and beneficial effects of drug exposures on condition occurrences is of interest in pharmacovigilance and drug repurposing.
		
		Baseline Regularization (1) is an efficient and accurate algorithm for identifying the effect of drug exposure on the risk of condition occurrence from LOD. LOD such as EMR contain a wealth of evidence about drug exposures and medical conditions, but the heterogeneity of the data across time and between patients makes it challenging to reliably infer relationships using standard statistical methods. Baseline Regularization explicitly addresses heterogeneity; it fits a time-varying patient-specific baseline risk and teases apart the patient- and time-specific changes in risk from the effects that drug exposures have on the risk of condition occurrence consistently across patients and across time. Here we present an open source implementation of the Baseline Regularization algorithm designed to work with LOD stored in databases that follow the OMOP CDM.
		
	};
	\end{scope}

	\begin{scope}[shift={(35cm,15cm)}]
		\node[color=white, fill=red, anchor=south west] {\large Methods};
		\node[anchor=north west, text width=30cm, align=left] {
			Baseline Regularization fits a Poisson regression model where the response is the occurrence of a condition of interest. We view each patient’s EMR as one or more observation periods during which the patient experiences intervals of exposure to drugs and occurrences of the condition on specific days (Figure 1). In the OMOP CDM, observation periods may be explicitly defined, if it is not, we may infer the observation period to last from the first to the last occurrences of conditions, patient visits, or drug exposures. Intervals of exposure to drugs directly correspond to the derived CDM Drug Era table; when this table isn’t available we may infer these intervals from the Drug Exposure clinical data table. The days of condition occurrence are taken to be either the start day of each Condition Era (derived table) or the start day of each Condition Occurrence (clinical table).
			
			(interval fig here)
			
			Given this view, of the data, each observation period is divided into homogeneous intervals within which the set of drugs to which the patient is exposed and the number of condition occurrences they have experienced is unchanging. We encode exposure to drug $m$ on day $j$ of observation period $i$ in a binary feature $x_{ijm}$, a baseline parameter $\tau_{ij}$ represents the baseline risk of condition occurrence on day $j$ of observation period $i$, a vector of coefficients $\beta_m$ represents the effect of exposure to drug $m$ on condition risk, and the response variable is a binary vector $y_{ij}$ indicating whether the condition occurred on day $j$ of observation period $i$. The log-likelihood function of the model is:
			
			$\displaystyle \log \mathcal{L} = $
			
			This likelihood function is overparametrized, and to address this issue, Baseline Regularization solves the regularized optimization problem
			
			$\displaystyle \arg \min \ldots$
			
			Kwong et al. (1) derive the algorithm for solving this optimization efficiently, which we implement in our package.
			The result of fitting baseline regularization to data yields the baseline coefficients $\tau$, drug coefficients $\beta$. The latter represent the effect of drug exposures on the risk of condition occurrence. Large positive coefficients may point to adverse reactions, while high magnitude negative coefficients may point to a beneficial effect (reduction of condition risk due to the drug).
		};
	\end{scope}

	%% Results and Discussion:
	\begin{scope}[shift={(70cm,15cm)}]
		\node[color=white, fill=red, anchor=south west] {\large Results and Discussion};
		\node[anchor=north west, text width=30cm, align=left] {
			We implemented Baseline Regularization and made it available as an R package on github http://github.com/sverchkov/BaselineRegularization. The package is designed to work either with the Standardized Clinical Data Tables or with the Standardized Derived Elements of the OMOP CDM.
			
			While it is up to the user to choose appropriate values for the regularization parameters $\lambda_1$, $\lambda_2$, and $\lambda_3$, we provide defaults that have been shown to perform well in previous studies (1). Since we utilize the dplyr package (2) in our conversion of the data from the CDM to the matrix and vector notation used by the optimization problem, our package can work with a variety of database backends as well as in-memory tables (R dataframes), and can handle working with combinations of data sources. For best results with large datasets, however, we recommend that all tables come from the same full-featured relational database. We also provide additional data processing utilities, which enable the user to easily work with different levels of drug and condition abstraction: the data in clinical tables needs to be at the most specific level, but a pharmacovigilance/repurposing analysis may be better performed at a higher level of abstraction, where, instead of using a specific drug as a feature, a researcher might want to use a general category such as “Beta Blockers” as a drug feature.
			
			We plan to continue maintaining and extending the package in response to community needs in order to facilitate adoption and application of Baseline Regularization in the OHDSI network and the broader research community.
			
		};
	\end{scope}


	%% Refs:
	\begin{scope}[shift={(70cm,70cm)}]
	\node[color=white, fill=red, anchor=south west] {\large References};
	\node[anchor=north west, text width=30cm, align=left] {
		(todo)
	};
	\end{scope}

    %% Code?
	\begin{scope}[shift={(35cm, 70cm)}]
		\node[anchor=north west, inner sep=0] { \lstinputlisting{example.R} };
	\end{scope}
	
	\end{tikzpicture}
\end{frame}
\end{document}